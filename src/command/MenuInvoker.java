package command; // Оголошення пакету, в якому знаходиться цей клас

import java.util.LinkedHashMap; // Імпорт LinkedHashMap (зберігає порядок додавання елементів)
import java.util.Map; // Імпорт інтерфейсу Map (для створення словника "Назва пункту" -> "Команда")
import java.util.Scanner; // Імпорт сканера для зчитування вводу користувача

/**
 * Клас, що відповідає за відображення меню та виконання команд.
 * (Invoker у патерні Command)
 */
public class MenuInvoker { // Оголошення класу
    // LinkedHashMap зберігає команди. Ключ (String) - це текст меню, Значення (Command) - це об'єкт команди.
    // Використовуємо саме LinkedHashMap, щоб пункти виводилися в тому порядку, в якому ми їх додали (1, 2, 3...), а не хаотично.
    private Map<String, Command> menu = new LinkedHashMap<>();

    private Scanner scanner; // Поле для зберігання об'єкта сканера (для читання з консолі)

    // Конструктор класу. Приймає сканер ззовні (з Main), щоб використовувати один і той самий потік вводу.
    public MenuInvoker(Scanner scanner) {
        this.scanner = scanner; // Ініціалізуємо поле сканера
    }

    // Метод реєстрації нової команди в меню.
    // name - це текст, який бачить користувач (напр., "1. Створити...").
    // cmd - це об'єкт команди, яка виконається при виборі.
    public void register(String name, Command cmd) {
        menu.put(name, cmd); // Додаємо пару "Назва -> Команда" у нашу мапу
    }
    // Головний цикл програми. Запускає меню і тримає програму працюючою.
    public void run() {
        while (true) { // Нескінченний цикл: меню буде показуватися знову і знову після виконання команди
            System.out.println("\n--- МЕНЮ ---"); // Виводимо візуальний роздільник/заголовок

            // Проходимо по всіх ключах (назвах пунктів) у мапі і виводимо їх на екран
            // System.out::println - це скорочений запис для друку кожного елемента
            menu.keySet().forEach(System.out::println);

            System.out.print(">> Ваш вибір: "); // Виводимо запрошення до вводу (без переходу на новий рядок)
            String input = scanner.nextLine(); // Зчитуємо те, що ввів користувач, у змінну input

            // --- ЛОГІКА ПОШУКУ КОМАНДИ ---
            // Ми шукаємо ключ у мапі, який відповідає вводу користувача.
            // Наприклад, якщо користувач ввів "1", ми шукаємо ключ, який починається з "1."
            String key = menu.keySet().stream() // Перетворюємо набір ключів у потік (Stream) для пошуку
                    // Фільтруємо: шукаємо ключ k, який починається з "ввід + крапка" АБО дорівнює вводу
                    .filter(k -> k.startsWith(input + ".") || k.equals(input))
                    .findFirst() // Беремо перший знайдений відповідний ключ
                    .orElse(null); // Якщо нічого не знайшли, повертаємо null

            if (key != null) { // Якщо ключ знайдено (тобто команда існує)
                // Отримуємо об'єкт команди з мапи за ключем (menu.get(key))
                // І викликаємо її метод execute() для запуску логіки
                menu.get(key).execute();
            } else { // Якщо key == null (користувач ввів щось неправильне)
                System.out.println("Невідома команда, спробуйте ще раз."); // Виводимо повідомлення про помилку
            }
        }
    }
}